<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a">
    <title>üí≠ Capture</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <header>
            <div class="logo">üí≠ thought capture</div>
            <div class="status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">ready</span>
            </div>
        </header>

        <div id="updateBanner" class="update-banner">
            <span>üéâ New version available!</span>
            <button class="btn-secondary" onclick="reloadApp()">Update Now</button>
        </div>

        <div id="syncBanner" class="sync-banner" style="display: none;">
            <span>Auto-sync not configured</span>
            <button class="btn-secondary" onclick="openSettings()">Setup</button>
        </div>

        <div class="capture-area">
            <textarea id="thoughtInput" placeholder="What's on your mind?" autofocus></textarea>
            <div class="actions">
                <button class="btn-primary" onclick="captureThought()">Capture</button>
                <button class="btn-secondary" onclick="exportToday()">üì• Today</button>
                <button class="btn-secondary btn-icon" onclick="openSettings()" title="Settings">‚öôÔ∏è</button>
            </div>
        </div>

        <div class="history">
            <div class="history-header">
                <span class="history-title">Recent</span>
            </div>
            <div class="thoughts-list" id="thoughtsList"></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">Settings</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Input Mode</label>
                    <select id="inputMode" style="background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text); font-family: inherit; font-size: 13px;">
                        <option value="multiline">Multi-line (Cmd/Ctrl+Enter to capture)</option>
                        <option value="single">Single-line (Enter to capture)</option>
                    </select>
                    <div class="help-text">
                        Multi-line for longer thoughts, single-line for quick captures
                    </div>
                </div>

                <div style="border-top: 1px solid var(--border); margin: 16px 0;"></div>
                <div style="font-size: 12px; color: var(--muted); margin-bottom: 16px;">GitHub Auto-Sync</div>
                <div class="form-group">
                    <label class="form-label">GitHub Personal Access Token</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxx">
                    <div class="help-text">
                        Create at <a href="https://github.com/settings/tokens/new?scopes=repo" target="_blank">github.com/settings/tokens</a>
                        <br>Required scope: <strong>repo</strong> (Full control of private repositories)
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Repository (owner/repo)</label>
                    <input type="text" id="githubRepo" placeholder="ishakuta/obsidian-vault">
                </div>

                <div class="form-group">
                    <label class="form-label">File Path (in repo)</label>
                    <input type="text" id="githubPath" placeholder="Daily Notes/{date}.md" value="Daily Notes/{date}.md">
                    <div class="help-text">
                        Use <strong>{date}</strong> for current date (YYYY-MM-DD)
                        <br>Example: Daily Notes/2025-12-28.md
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Branch</label>
                    <input type="text" id="githubBranch" placeholder="main" value="main">
                    <div class="help-text">
                        Git branch to sync to (usually <strong>main</strong> or <strong>master</strong>)
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Sync Mode</label>
                    <select id="syncMode" style="background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text); font-family: inherit; font-size: 13px;">
                        <option value="auto">Auto (Background Sync)</option>
                        <option value="manual">Manual Only</option>
                    </select>
                    <div class="help-text" id="syncModeHelp">
                        Auto mode syncs in background when online (battery-efficient)
                    </div>
                </div>

                <div class="form-group" style="margin-top: 16px;">
                    <button class="btn-secondary" style="width: 100%;" onclick="manualSync()">üîÑ Sync Now</button>
                    <div class="help-text">
                        Manually trigger GitHub sync (uploads unsynced thoughts)
                    </div>
                </div>

                <!-- Experimental Features Section (only visible when experimental mode enabled) -->
                <div id="experimentalFeaturesSection" style="display: none;">
                    <div style="border-top: 1px solid var(--border); margin: 16px 0;"></div>
                    <div style="font-size: 12px; color: var(--accent); margin-bottom: 16px;">üß™ Experimental Features</div>
                    <div id="experimentalFeaturesList"></div>
                    <div class="help-text" style="margin-top: 8px;">
                        Enable experimental features at your own risk. Use console <code style="background: var(--bg); padding: 2px 6px; border-radius: 4px;">featureFlags.list()</code> for details.
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; flex-direction: column; gap: 12px;">
                <div style="display: flex; gap: 8px; width: 100%;">
                    <button class="btn-secondary" style="flex: 1;" onclick="exportAll()">üì• Export All (.md)</button>
                    <button class="btn-secondary" onclick="closeSettings()">Cancel</button>
                    <button class="btn-primary" onclick="saveSettings()">Save</button>
                </div>
                <div style="font-size: 10px; color: var(--muted); text-align: center;" id="versionDisplay">
                    Version loading...
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
